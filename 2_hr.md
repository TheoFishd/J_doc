# >> HR модуль

Содержание:
- [Пользовательский уровень](#пользовательский-уровень)
- [Админ уровень](#админ-уровень)
    - [Общие принцыпы](#общие-принцыпы)
        -[Кэширование сотрудников ](#кэширование-сотрудников)
    - [Процедура авторизации нового сотрудника в ассистент](#процедура-авторизации-нового-сотрудника-в-ассистент)
    - [Структура](#структура)
        - [Сотрудники](#структура)
        - [Права](#права)
        - [Пуши](#пуши)


# Пользовательский уровень
Для получения доступа к ассистенту, нужно подключиться к телеграм боту ассистента компании. И передать в текстовом сообщении код авторизации. При положительном завершении операции сотрудник получает доступ к функциям ассистента согласно своей должности в компании. Базовый функционал для всех сотрудников это доступ ассистента к вектор стор базе регламентов с возможностью RAG 
> Пользовательский уровень HR модуля к расширению - получение информации о себе и других сотрудниках, онбординг новых сотрудников.

# Админ уровень
## Общие принцыпы
В текущей версии основное управление взаимодействием сотрудникв с ассистентом происходит через таблицу сотрудников (ссылка на нее должна былть установленна в [настроечной таблице](1_system.md#настроечная-таблица)).
### Кэширование сотрудников  
Сотрудники кэшируются при запуске системы. И рекэшируются *только* при добавлении нового пользователя или перезапуске системы. Это означает что в случае изменения администратором данных в таблице сотрудники они вступят в силу толькол после перезапустка системы.
>В ближайшем обновлении в ассистент будет добавлена команда для рекеширования сотрудников по запросу администратора. В будующем будет добавлен механизм построенный на webhook для рекеширования данных при изменении данных в таблице сотрудников

## Процедура авторизации нового сотрудника в ассистент
Для предоставления доступа к ассистенту, администратор должен сгенерировать ключ авторизации отправив команду `/key ` ассистенту. Полученный ключ администратор должен поместить в строку сданных о сотруднике в колонку `Код AI`, после чего передать код соответствующему сотруднику.  
После введения сотрудником ключа авторизации, ключ авторизации будет удален из таблицы, а в колонку `Assistant id` сотрудника установится его телеграм id.  
Наличие телеграм id в колонке `Assistant id` свидетельствует о том что сотрудник зарегестрирован в ассистенте.
> В будущем таблица сотрудников не будет соджержать в открытом виде данные о телеграм аккаунте и возможно какие-то еще чуствительные данные. Они будут зашифрованы или содердаться в отдельной базе, что бы администратор не мог использовать эти данные в личных целях.

## Структура
>**! ВАЖНО**: Структура листов и их названия должны оставаться неизменны. Изменение приведет к неработоспособности системы.
Листы таблицы сотрудников должны иметь имена: [`Сотрудники`](#сотрудники), [`Права`](#права), [`Пуши`](#пуши)


### Сотрудники
Лист `Сотрудники`  
>**! ВАЖНО**: для получения данных о сотрудниках, модуль опирается на имена колонок - перывя строка на листе таблицы сотрудников. Изменение имен приведет к неработоспособности модуля. В текущей версии обязательные колонки для работы системы: `Сотрудник ID`, `Фамилия`, `Имя`, `Отчество`, `ЮНИТ`, `Должность`, `Email`, `Assistant id`, `Код AI`, `Conv_id`

> Администратор может добавлять любые нужные ему колонки, это не повлияет на работу модуля, так же *не важен* порядок колонок.

`Сотрудник ID` Используется как читаемый ID сотрудника учавствующий в работе.  
`Должность` Используется для составления правил доступов к функциям ассистента и рассылок уведомлений
`ЮНИТ` Используется для составления правил рассылок уведомлений
`Email` Используется как референс на basecamp аккаунт сотрудника
`Код AI` Используется в процессе [авторизации сотрудника](#процедура-авторизации-нового-сотрудника-в-ассистент)
`Assistant id` Ключевое поля для связи сотрудников с ассистентом
`Conv_id` поле содержащее id текущей `conversation` пользователя, связывающее чат пользователя ассистета с его контекстным окном openai. Данное поле, если пустое, автоматически заполняется при кэшировании сотрудников. Используя значение `Conv_id` в поиске https://platform.openai.com/logs?api=conversations можно посмотреть текущей [контекст пользоватебя](4_openai.md#контекст-пользователя)

> **Примечание**: Если удалить значение поля `Conv_id` и потом [рекэшировать](#общие-принцыпы) сотрудников, то асситент создаст и запишет новое значени в `Conv_id`, что приведет к обнулению контекста пользователя. Это может быть крайней мерой решения проблемы входа ассистента в цикл галюцинаций ИИ.

### Права
Лист `Права`
На основе этого листа составляются правила доступа сотрудников к функциям ассистента исходя из их прав.
Для получения данных с этого листа система опирается на порядок колонок. первая колонка - роль, третья колонка доступа/не доступна функция создания проекта
>Пока до конца не прояснились правила конструирования таблиц прав, таблица обрабатывается не гибко, поэтому изменение порядка колонок повлияет на работу модуля а именно на составление таблицы прав
### Пуши
>Пока до конца не прояснились правила конструирования таблицы пуш уведомлений, таблица обрабатывается не гибко, поэтому **изменение порядка колонок** или **изменение имен колонок** (первая строка листа) **повлияет на работу** модуля а именно на составление таблицы прав

