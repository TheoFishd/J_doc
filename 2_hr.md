[<<Оглавление](0_index.md)
# >> HR модуль

Содержание:
- [Пользовательский уровень](#пользовательский-уровень)
- [Админ уровень](#админ-уровень)
    - [Общие принципы](#общие-принципы)
        - [Кэширование сотрудников](#кэширование-сотрудников)
    - [Процедура авторизации нового сотрудника в ассистент](#процедура-авторизации-нового-сотрудника-в-ассистент)
    - [Структура](#структура)
        - [Сотрудники](#структура)
        - [Права](#права)
        - [Пуши](#пуши)

# Пользовательский уровень
Для получения доступа к ассистенту нужно подключиться к телеграм-боту ассистента компании и передать в текстовом сообщении код авторизации. При положительном завершении операции сотрудник получает доступ к функциям ассистента согласно своей должности в компании. Базовый функционал для всех сотрудников — это доступ ассистента к вектор-стор базе регламентов с возможностью RAG.  
> Пользовательский уровень HR-модуля к расширению — получение информации о себе и других сотрудниках, онбординг новых сотрудников.

# Админ уровень
## Общие принципы
В текущей версии основное управление взаимодействием сотрудников с ассистентом происходит через таблицу сотрудников (ссылка на неё должна быть установлена в [настроечной таблице](1_system.md#настроечная-таблица)).

### Кэширование сотрудников  
Сотрудники кэшируются при запуске системы и рекэшируются *только* при добавлении нового пользователя или перезапуске системы. Это означает, что в случае изменения администратором данных в таблице сотрудники они вступят в силу только после перезапуска системы.  
> В ближайшем обновлении в ассистент будет добавлена команда для рекэширования сотрудников по запросу администратора. В будущем будет добавлен механизм, построенный на webhook, для рекэширования данных при изменении данных в таблице сотрудников.

## Процедура авторизации нового сотрудника в ассистент
Для предоставления доступа к ассистенту администратор должен сгенерировать ключ авторизации, отправив команду `/key` ассистенту. Полученный ключ администратор должен поместить в строку с данными о сотруднике в колонку `Код AI`, после чего передать код соответствующему сотруднику.  
После введения сотрудником ключа авторизации ключ будет удалён из таблицы, а в колонку `Assistant id` сотрудника установится его телеграм-id.  
Наличие телеграм-id в колонке `Assistant id` свидетельствует о том, что сотрудник зарегистрирован в ассистенте.  
> В будущем таблица сотрудников не будет содержать в открытом виде данные о телеграм-аккаунте и, возможно, какие-то ещё чувствительные данные. Они будут зашифрованы или содержаться в отдельной базе, чтобы администратор не мог использовать эти данные в личных целях.

## Структура
> **! ВАЖНО**: Структура листов и их названия должны оставаться неизменными. Изменение приведёт к неработоспособности системы.  
Листы таблицы сотрудников должны иметь имена: [`Сотрудники`](#сотрудники), [`Права`](#права), [`Пуши`](#пуши)

### Сотрудники
Лист `Сотрудники`  
> **! ВАЖНО**: для получения данных о сотрудниках модуль опирается на имена колонок — первая строка на листе таблицы сотрудников. Изменение имён приведёт к неработоспособности модуля. В текущей версии обязательные колонки для работы системы: `Сотрудник ID`, `Фамилия`, `Имя`, `Отчество`, `ЮНИТ`, `Должность`, `Email`, `Assistant id`, `Код AI`, `Conv_id`

> Администратор может добавлять любые нужные ему колонки — это не повлияет на работу модуля. Также *не важен* порядок колонок.

- `Сотрудник ID` — используется как читаемый ID сотрудника, участвующий в работе.  
- `Должность` — используется для составления правил доступов к функциям ассистента и рассылок уведомлений.  
- `ЮНИТ` — используется для составления правил рассылок уведомлений.  
- `Email` — используется как референс на basecamp-аккаунт сотрудника.  
- `Код AI` — используется в процессе [авторизации сотрудника](#процедура-авторизации-нового-сотрудника-в-ассистент).  
- `Assistant id` — ключевое поле для связи сотрудников с ассистентом.  
- `Conv_id` — поле, содержащее id текущей `conversation` пользователя, связывающее чат пользователя ассистента с его контекстным окном openai. Данное поле, если пустое, автоматически заполняется при кэшировании сотрудников. Используя значение `Conv_id` в поиске https://platform.openai.com/logs?api=conversations можно посмотреть текущий [контекст пользователя](4_openai.md#контекст-пользователя).

> **Примечание**: Если удалить значение поля `Conv_id` и потом [рекэшировать](#общие-принципы) сотрудников, то ассистент создаст и запишет новое значение в `Conv_id`, что приведёт к обнулению контекста пользователя. Это может быть крайней мерой решения проблемы входа ассистента в цикл галлюцинаций ИИ.

### Права
Лист `Права`  
На основе этого листа составляются правила доступа сотрудников к функциям ассистента исходя из их прав.  
Для получения данных с этого листа система опирается на порядок колонок: первая колонка — роль, третья колонка — доступ/недоступность функции создания проекта.  
> Пока до конца не прояснились правила конструирования таблиц прав, таблица обрабатывается негибко, поэтому изменение порядка колонок повлияет на работу модуля, а именно на составление таблицы прав.

### Пуши
> Пока до конца не прояснились правила конструирования таблицы push-уведомлений, таблица обрабатывается негибко, поэтому **изменение порядка колонок** или **изменение имён колонок** (первая строка листа) **повлияет на работу** модуля, а именно на составление таблицы прав.
